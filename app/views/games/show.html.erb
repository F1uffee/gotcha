<%# 1/ PARTIE PENDING %>

<%= turbo_stream_from "avatars" %>
<%= turbo_stream_from "redirect" %>


<% if @game.status == "pending" %>
  <h1>EN ATTENTE DE JOUEURS....</h1>
<br>

<div data-controller="clipboard" data-clipboard-success-content-value="Copied!">
  <% if @game.user_id == current_user.id %>
    <h2>LIEN D'INVITATION:</h2>
    <div class="game-link">
    <div class="link"><%= link_to "www.gotyou.fr/avatars/new?game_id=#{@game.id}", input_html: {class:"invite-link"}, data: {clipboard_target: "source"}%></div>
    <div><button class="btn-clipboard" data-action="clipboard#copy" data-clipboard-target="button"><i class="fa-regular fa-copy fa-xl" style="color: #ffffff;"></i></button></div>
    </div>
  <% end %>
</div>

<%# Affichage des joueurs%>
<%= render "avatars" %>

    <div id="redirect">
    </div>

  <%# Bouton lancer la partie pour owner %>
  <% if @game.user_id == current_user.id %>
      <%= button_to "Lancer la partie", game_path(@game, status: "running"),method: :patch, class: "button-primary"%>
  <% end %>
<% end %>
<%# 2/ PARTIE RUNNING %>
<% if @game.status == "running" %>
<%# Titre "Manche xx" terminée ou partie terminée %>
  <% if params[:question] == "2" %>
    <h2>Partie terminée</h2>
  <% else %>
    <h2>Manche <%=params[:question].to_i + 1 %> terminée</h2>
  <% end %>
  <%# Affichage des scores %>
  <div id="container-player-cards">
    <div class="player-card <%= @owner.color %>">
      <%= image_tag("avatars/#{@owner.url}.png") %>
      <div class="pseudo">
        <%= @owner.name %> : <%= @owner.score %> points
      </div>
      </div>
        <% @avatars.each do |avatar| %>
          <div class="player-card <%= avatar.color %>">
            <%= image_tag("avatars/#{avatar.url}.png") %>
              <div class="pseudo">
                <%= avatar.name %> : <%= avatar.score %> points
              </div>
            </div>
          <% end %>
  </div>


  <%# Redirection et bouton retour à l'accueil en fin de partie %>
  <% if params[:question].nil? %>
    <%= link_to "manche suivante", game_path(@game) %>
  <% else %>
    <% if params[:question] == "2" %>
      <%= button_to "Retour à l'accueil", game_path(@game, status: "finished"),method: :patch, class: "button-primary" %>
    <% else %>
      <div data-controller="autolink">
        <%= link_to "manche suivante", game_path(@game, question: params[:question].to_i + 1), data: {autolink_target:"link_two" }, class: "d-none"  %>
      </div>
      <%# <%= link_to "manche suivante", game_path(@game, question: params[:question].to_i + 1) %>
    <% end %>
  <% end %>
<% end %>
